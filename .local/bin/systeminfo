#!/bin/sh

weatherfile=$XDG_CACHE_HOME/weather

if [ -f $weatherfile ]; then
	weather=$(cut -sd';' -f1 $weatherfile)
	weather_update_time=$(cut -sd';' -f2 $weatherfile)
	weather_string="$weather (updated at $weather_update_time)"
else
	weather_string="No weather data exist."
fi

time=$(date +"%H:%M")
date=$(date +"%d %b, %a")

for battery in /sys/class/power_supply/BAT*; do
	case $(cat $battery/status) in
	"Charging")
		battery_icon=🔺
		;;
	"Discharging")
		battery_icon=🔻
		;;
	esac

	charge=$(cat $battery/capacity)
	battery_data="$battery_data🔋$charge%$battery_icon "
done

# We have one trailing space after the loop, so add it here as well
[ -z "$battery_data" ] && battery_data="🔌 No battery "

network=$(nmcli | grep -oi 'connected to.*' | cut -d' ' -f 3)
[ -z "$network" ] && network="Not connected"

notify-send "$weather_string" \
	"🕐 $time  📅 $date  $battery_data 🌊 $network"
