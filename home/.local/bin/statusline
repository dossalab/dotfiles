#!/bin/sh

# Simple modular status bar

add () {
    statusline="$statusline$1  "
}

plug_time () {
    add "ðŸ•› $(date +"%H:%M")"
}

plug_date () {
    add "ðŸ“… $(date +"%d %b, %a")"
}

plug_batteries () {
    for node in /sys/class/power_supply/BAT*; do
        case $(cat $node/status) in
        "Charging")
            icon=ðŸ”º ;;
        "Discharging")
            icon=ðŸ”» ;;
        esac

        add "ðŸ”‹ $(cat $node/capacity)%$icon"
    done
}

plug_connections () {
    for connection in $(nmcli -t -f name connection show --active); do
        add "ðŸ”— $connection"
    done
}

plug_bluetooth () {
    [ -z "$(bluetoothctl list)" ] && return

    for device in $(bluetoothctl devices Connected | cut -d " " -f3); do
        add "ðŸ”µ $device"
    done
}

plug_disks () {
    for point in / /home; do
        usage=$(findmnt "$point" -no "TARGET,USE%" | sed "s/  */ â†’ /g")
        [ ! -z "$usage" ] && add "ðŸ’¾ $usage"
    done
}

for arg in $@; do
    case $arg in
    time)
        plug_time ;;
    date)
        plug_date ;;
    batteries)
        plug_batteries ;;
    connections)
        plug_connections ;;
    bluetooth)
        plug_bluetooth ;;
    disks)
        plug_disks ;;
    esac
done

[ ! -z "$statusline" ] && echo "$statusline"
